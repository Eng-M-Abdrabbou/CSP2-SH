<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forum</title>
  <style>
    .forum-card { border: 1px solid #ccc; padding: 1em; margin: 1em 0; }
    .comments { display: none; margin-top: 1em; }
    .comment { border-top: 1px solid #eee; padding: 0.5em 0; }
  </style>
</head>
<body>
  <h1>Discussion Forum</h1>
  <div id="forum-container"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/forums')
        .then(response => response.json())
        .then(forums => {
          const forumContainer = document.getElementById('forum-container');
          forums.forEach(forum => {
            const forumCard = document.createElement('div');
            forumCard.className = 'forum-card';
            forumCard.innerHTML = `
              <h2>${forum.title}</h2>
              <p>${forum.content}</p>
              <p><strong>Created by: ${forum.username} (ID: ${forum.user_id})</strong></p>
              <button onclick="toggleComments(${forum.id})">Show Comments</button>
              <div id="comments-${forum.id}" class="comments"></div>
              <form onsubmit="addComment(event, ${forum.id})">
                <input type="hidden" name="user_id" value="USER_ID_HERE"> <!-- Replace with actual user ID -->
                <textarea name="content" placeholder="Add a comment" required></textarea>
                <input type="text" name="image_url" placeholder="Image URL">
                <button type="submit">Submit</button>
              </form>
            `;
            forumContainer.appendChild(forumCard);
          });
        });
    });

    function toggleComments(forumId) {
      const commentDiv = document.getElementById(`comments-${forumId}`);
      if (commentDiv.style.display === 'none') {
        fetch(`/comments?forum_id=${forumId}`)
          .then(response => response.json())
          .then(comments => {
            commentDiv.innerHTML = '';
            comments.forEach(comment => {
              const commentElement = document.createElement('div');
              commentElement.className = 'comment';
              commentElement.innerHTML = `
                <strong>${comment.username} (ID: ${comment.user_id})</strong>
                <p>${comment.content}</p>
                <img src="${comment.image_url}" alt="Comment Image">
              `;
              commentDiv.appendChild(commentElement);
            });
            commentDiv.style.display = 'block';
          });
      } else {
        commentDiv.style.display = 'none';
      }
    }

    function addComment(event, forumId) {
      event.preventDefault();
      const form = event.target;
      const user_id = form.user_id.value;
      const content = form.content.value;
      const image_url = form.image_url.value;

      fetch('/comments', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ forum_id: forumId, user_id, content, image_url })
      })
      .then(() => {
        form.reset();
        toggleComments(forumId);
      });
    }
  </script>
</body>
</html>
