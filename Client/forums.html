<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum App</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .forum, .comment { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }

        .forum-cards-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}

.forum {
  margin: 2rem;
  width: 40rem;
}
       
    </style>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

   <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
   
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  </head>
<body>

    <h1>Forum App</h1>
  
    <div class="card">
      <div class="card-header">
        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse-create-forum" aria-expanded="false" aria-controls="collapse-create-forum">
          Create Forum
        </button>
      </div>
      <div id="collapse-create-forum" class="collapse">
        <div class="card-body">
          <h2>Create Forum</h2>
          <form id="createForumForm">
            <div class="form-group">
              <label for="forumTitle" class="col-form-label text-center">Title</label>
              <input type="text" id="forumTitle" placeholder="Title" required>
            </div>
            <div class="form-group">
              <label for="forumContent" class="col-form-label text-center">Content</label>
              <textarea id="forumContent" placeholder="Content" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Create</button>
          </form>
        </div>
      </div>
    </div>

    <div id="forums"></div>

    <script>
        const userId = 8;
        const apiUrl = 'http://localhost:8000';
        console.log('User ID:', userId);

        document.getElementById('createForumForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const title = document.getElementById('forumTitle').value;
            const content = document.getElementById('forumContent').value;
            fetch(`${apiUrl}/forums`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'user-id': userId
                },
                body: JSON.stringify({ title, content })
            })
            .then(response => response.text())
            .then(data => alert(data))
            .catch(error => console.error('Error:', error));
        });

        function loadForums() {
          fetch(`${apiUrl}/forums`)
  .then(response => response.json())
  .then(forums => {
    const forumsDiv = document.getElementById('forums');
    forumsDiv.innerHTML = ''; // Clear the previous forums

    // Create a container for the forum cards
    const forumCardsContainer = document.createElement('div');
    forumCardsContainer.className = 'forum-cards-container';

    forums.forEach(forum => {
  const forumElement = document.createElement('div');
  forumElement.className = 'forum';
  forumElement.innerHTML = `
   <div class="card" data-forum-id="${forum.id}">
  <div class="card-header">
    The forum is made by : ${forum.user_id}
  </div>
  <div class="card-body">
    <h5 class="card-title">${forum.title}</h5>
    <p class="card-text">${forum.content}.</p>
    ${forum.user_id == userId ? `<button class="btn btn-danger" onclick="deleteForum(${forum.id})">Delete forum</button>` : ''}

    
    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse-${forum.id}" aria-expanded="false" aria-controls="collapse-${forum.id}">
      View Comments
    </button>
    <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#createCommentModal-${forum.id}">
      Add Comment
    </button>
    <div class="collapse" id="collapse-${forum.id}">
      <div class="card card-body">
        <h5>Comments:</h5>
        <div id="comments-${forum.id}"></div>
      </div>
    </div>
  </div>
</div>

<!-- Modal to create comment -->
<div class="modal fade" id="createCommentModal-${forum.id}" tabindex="-1" role="dialog" aria-labelledby="createCommentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createCommentModalLabel">Add Comment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="createCommentForm-${forum.id}">
          <input type="text" id="commentContent-${forum.id}" placeholder="Comment" required>
          <button type="submit">Comment</button>
        </form>
      </div>
    </div>
  </div>
</div>
  `;
      forumCardsContainer.appendChild(forumElement);
      forumsDiv.appendChild(forumCardsContainer);

                // Fetch comments for this forum
                fetch(`${apiUrl}/forums/${forum.id}/comments`)
                    .then(response => response.json())
                    .then(comments => {
                        const commentsDiv = document.getElementById(`comments-${forum.id}`);
                        comments.forEach(comment => {
                          const commentElement = document.createElement('div');
commentElement.className = 'comment';
const commentText = document.createElement('p');
commentText.textContent = `Commented by User ID: ${comment.user_id} - ${comment.content}`;

const commentContainer = document.createElement('div');
commentContainer.appendChild(commentText);

if (comment.user_id == userId) {
  const deleteButton = document.createElement('button');
  deleteButton.className = 'btn btn-danger btn-sm';
  deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i> Delete';
  deleteButton.onclick = () => deleteComment(comment.id);
  commentContainer.appendChild(deleteButton);
}

commentElement.appendChild(commentContainer);
commentsDiv.appendChild(commentElement);
                        });
                    })
                    .catch(error => console.error('Error fetching comments:', error));

                // Add event listener for comment form submission
                document.getElementById(`createCommentForm-${forum.id}`).addEventListener('submit', function (e) {
                    e.preventDefault();
                    const commentContent = document.getElementById(`commentContent-${forum.id}`).value;
                    createComment(commentContent, forum.id);
                });
            });
        })
        .catch(error => console.error('Error:', error));
}

        


function createComment(content, forumId) {
  fetch(`${apiUrl}/forums/${forumId}/comments`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'user-id': userId
    },
    body: JSON.stringify({ content: content }) // Send content as a JSON object
  })
  .then(response => response.text())
  .then(data => {
    alert(data);
    loadComments(forumId);
  })
  .catch(error => console.error('Error:', error));
}


        function deleteComment(commentId) {
            fetch(`${apiUrl}/comments/${commentId}`, {
                method: 'DELETE',
                headers: {
                    'user-id': userId
                }
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                loadForums();
            })
            .catch(error => console.error('Error:', error));
        }

        function deleteForum(forumId) {
  fetch(`${apiUrl}/forums/${forumId}`, {
    method: 'DELETE',
    headers: {
      'user-id': userId
    }
  })
  .then(response => response.text())
  .then(data => {
    alert(data);
    const forumElement = document.querySelector(`.forum[data-forum-id="${forumId}"]`);
    if (forumElement) {
      forumElement.remove();
    }
    loadForums();
  })
  .catch(error => console.error('Error:', error));
}
       
        loadForums();
    </script>
</body>
</html>


