<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
    <!-- Previous head content remains the same -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Log in - StreamHub</title>
    <meta name="description" content="Experience seamless streaming with Stream Hub. Our platform integrates advanced social media features and an AI-driven recommendation system to personalize your entertainment.">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/Inter.css">
    <link rel="stylesheet" href="assets/css/untitled.css">
    <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Previous styles remain the same -->
    <style>
        /* Previous styles remain the same */
        .fjalla-one-regular {
            font-family: 'Fjalla One', sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #000; 
        }
        ::-webkit-scrollbar-thumb {
            background: #fff;
        }

        /* Panda Styles */
        .panda-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            top: 50px;
        }
        .panda-face {
            height: 120px;
            width: 134px;
            background-color: #ffffff;
            border: 3px solid #000000;
            border-radius: 120px 120px 90px 90px;
            position: relative;
            margin: auto;
            margin-top: 10px;
        }
        .ear-l, .ear-r {
            background-color: #000000;
            height: 40px;
            width: 45px;
            border: 3px solid #000000;
            border-radius: 40px 40px 0 0;
            position: absolute;
            top: 28px;
        }
        .ear-l {
            transform: rotate(-38deg);
            left: 172px;
        }
        .ear-r {
            transform: rotate(38deg);
            right: 172px;
        }
        .eye-l, .eye-r {
            background-color: #000000;
            height: 35px;
            width: 32px;
            border-radius: 32px;
            position: absolute;
            top: 35px;
            transition: height 0.3s;
        }
        .eye-l {
            left: 22px;
            transform: rotate(-20deg);
        }
        .eye-r {
            right: 22px;
            transform: rotate(20deg);
        }
        .eyeball-l, .eyeball-r {
            height: 10px;
            width: 10px;
            background-color: #ffffff;
            border-radius: 50%;
            position: absolute;
            left: 10px;
            top: 10px;
            transition: 0.3s all;
        }
        .nose {
            height: 16px;
            width: 16px;
            background-color: #000000;
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            border-radius: 19px 0 0 4px;
        }
        .mouth {
            height: 12px;
            width: 15px;
            position: absolute;
            top: 85px;
            left: 50px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: 0 3px #000000;
        }
        .mouth:before {
            content: "";
            position: absolute;
            height: 12px;
            width: 15px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: 0 3px #000000;
            left: 14px;
        }
        
        /* Eyes closed state */
        .eyes-closed .eye-l,
        .eyes-closed .eye-r {
            height: 4px;
            border-radius: 0;
        }
        .eyes-closed .eyeball-l,
        .eyes-closed .eyeball-r {
            opacity: 0;
        }

        /* Custom card styling */
        .login-card {
            background: rgb(255, 255, 255);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body style="background-color: rgb(0, 0, 0); color: rgb(255, 255, 255);">
    <!-- Navbar with Login and Sign Up buttons -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">StreamHub</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <!-- Add other links as needed -->
                </ul>
                <div class="d-flex justify-content-center align-items-center" style="gap: 10px;">
                    <a class="btn btn-dark shadow d-inline-block" role="button" href="login.html" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; line-height: 1.5;">Login</a>
                    <a class="btn btn-dark shadow d-inline-block" role="button" href="signup.html" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; line-height: 1.5;">Sign up</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="py-5">
        <div class="container py-5">
            <div class="row mb-4 mb-lg-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <p class="fw-bold text-success mb-2">Login</p>
                    <h2 class="fw-bold">Welcome back</h2>
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <div class="col-md-6 col-xl-4">
                    <div class="login-card">
                        <div class="panda-container">
                            <div class="ear-l"></div>
                            <div class="ear-r"></div>
                            <div class="panda-face">
                                <div class="eye-l">
                                    <div class="eyeball-l"></div>
                                </div>
                                <div class="eye-r">
                                    <div class="eyeball-r"></div>
                                </div>
                                <div class="nose"></div>
                                <div class="mouth"></div>
                            </div>
                        </div>
                        
                        <!-- Fixed form action -->
                        <form id="loginForm">
                            <div class="mb-3">
                                <input class="form-control" id="email" type="email" name="email" placeholder="Email" required>
                            </div>
                            <div class="mb-3">
                                <input class="form-control" id="password" type="password" name="password" placeholder="Password" required>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-dark shadow d-block w-100" type="submit">Log in</button>
                            </div>
                        </form>
                        <p class="text-center">don't have an account? <a href="signup.html" style="color: rgb(0, 0, 0);">Sign up</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Your footer code here -->

    <script>
        // Updated login form handling
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();  // Prevent default form submission

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            try {
                const response = await fetch('/login', {  // Changed from /login.html to /login
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });

                const data = await response.json();

                if (response.status === 401) {
                    console.log('Invalid email or password');
                    alert('Invalid email or password');
                } else if (response.ok) {
                    // Store session data if needed
                    if (data.success) {
                        localStorage.setItem('sessionData', JSON.stringify({
                            recommendations: data.recommendations
                        }));
                    }

                    // Check for admin status and redirect accordingly
                    const adminResponse = await fetch('/api/admin-email');
                    const adminData = await adminResponse.json();
                    
                    if (adminData.email === email) {
                        console.log('Admin login successful');
                        window.location.href = '/admin.html';
                    } else {
                        const movieId = localStorage.getItem('movieId');
                        if (movieId) {
                            console.log('Going to movie, Login successful');
                            window.location.href = `/userprofile.html?movieId=${movieId}`;
                        } else {
                            console.log('Login successful');
                            window.location.href = '/userprofile.html';
                        }
                    }
                } else {
                    console.log('An error occurred:', response.status);
                    alert('An error occurred, please try again.');
                }
            } catch (err) {
                console.error('Fetch error:', err);
                alert('An error occurred, please try again.');
            }
        });

        // Panda animation logic
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const pandaFace = document.querySelector('.panda-face');
        const eyeL = document.querySelector('.eye-l');
        const eyeR = document.querySelector('.eye-r');
        const eyeballL = document.querySelector('.eyeball-l');
        const eyeballR = document.querySelector('.eyeball-r');

        emailInput.addEventListener('focus', () => {
            pandaFace.classList.remove('eyes-closed');
            eyeballL.style.top = '5px';
            eyeballR.style.top = '5px';
        });

        passwordInput.addEventListener('focus', () => {
            pandaFace.classList.add('eyes-closed');
            eyeballL.style.top = '10px';
            eyeballR.style.top = '10px';
        });

        document.addEventListener('click', (e) => {
            if (e.target !== emailInput && e.target !== passwordInput) {
                pandaFace.classList.remove('eyes-closed');
                eyeballL.style.top = '10px';
                eyeballR.style.top = '10px';
            }
        });

        emailInput.addEventListener('input', (e) => {
            const inputRect = e.target.getBoundingClientRect();
            const inputCenter = inputRect.left + inputRect.width / 2;
            const normalizedPosition = (inputCenter - window.innerWidth / 2) / (window.innerWidth / 4);
            
            eyeballL.style.left = `${10 + normalizedPosition * 5}px`;
            eyeballR.style.left = `${10 + normalizedPosition * 5}px`;
        });
    </script>
</body>
</html>
